<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì£¼ë°© ì£¼ë¬¸ ê´€ë¦¬</title>
</head>
<body>
  <h1>ğŸ³ ì£¼ë°© ì£¼ë¬¸ ê´€ë¦¬</h1>

  <div id="orders">
    <p>ì£¼ë¬¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getFirestore, collection, doc, onSnapshot, getDocs, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB5fNlZwwqhutBm-iGGR4SX3HPUY6PR1cU",
    authDomain: "fjocs-57418.firebaseapp.com",
    projectId: "fjocs-57418",
    storageBucket: "fjocs-57418.firebasestorage.app",
    messagingSenderId: "1025344233506",
    appId: "1:1025344233506:web:edcf50e049f8b4ce18aa7b",
    measurementId: "G-059R0SJRLJ"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);


    const ordersRef = collection(db, "orders");

    onSnapshot(ordersRef, (snapshot) => {
      const ordersDiv = document.getElementById('orders');
      ordersDiv.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ë¹„ìš°ê¸°

      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        
        const orderDiv = document.createElement('div');
        orderDiv.style.border = "1px solid black";
        orderDiv.style.padding = "10px";
        orderDiv.style.marginBottom = "10px";

        orderDiv.innerHTML = `
  <h3>í…Œì´ë¸” ë²ˆí˜¸: ${data.tableNumber}</h3>
  <p><strong>í˜„ì¬ ìƒíƒœ:</strong> ${data.status}</p>
  <ul>
    ${data.items.map(item => `<li>${item.menu} (${item.quantity}ê°œ)</li>`).join('')}
  </ul>
  <button onclick="updateStatus('${docSnap.id}', 'ì¡°ë¦¬ ì¤‘')">ì¡°ë¦¬ ì¤‘ìœ¼ë¡œ ë³€ê²½</button>
  <button onclick="updateStatus('${docSnap.id}', 'ì„œë¹™ ì™„ë£Œ')">ì„œë¹™ ì™„ë£Œë¡œ ë³€ê²½</button>
  <button onclick="resetTable(${data.tableNumber})">í…Œì´ë¸” ë¦¬ì…‹</button>
`;


        ordersDiv.appendChild(orderDiv);
      });
    });

    window.updateStatus = async (docId, newStatus) => {
      const orderDoc = doc(db, "orders", docId);
      await updateDoc(orderDoc, { status: newStatus });
      alert(`ìƒíƒœë¥¼ '${newStatus}'ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤!`);
    };
    window.resetTable = async (tableNumber) => {
  if (confirm(`${tableNumber}ë²ˆ í…Œì´ë¸” ì£¼ë¬¸ì„ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
    await fetch(`/reset-table/${tableNumber}`, { method: 'POST' });
    alert('ì •ì‚° ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
    location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
  }
};

  </script>

</body>
</html>
